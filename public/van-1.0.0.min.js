let t,e,l,o,r=Object,n=r.getPrototypeOf,f=document,s=(t,e,l,o)=>(t??(setTimeout(l,o),new Set)).add(e),a={get val(){return l?.(this),this.t},get oldVal(){return l?.(this),this.l},set val(t){let l=this,o=l.t;if(t!==o){e=s(e,l,p),l.t=t;for(let e of l.o)e(t,o)}},onnew(t){this.o.push(t)}},i=n(a),u=t=>n(t??0)===a,d=t=>u(t)?t.val:t,g=t=>t.nodeType?t:new Text(t),h=t=>t.i=t.i.filter(t=>t.u?.isConnected),_=(e,r)=>{const n={f:e};return n.u=g(((t,e,o)=>{let r=l;l=e;let n=t(o);return l=r,n})(e,e=>{o=s(o,e,()=>(o.forEach(h),o=t),1e3),e.i.push(n)},r))},w=(e,...l)=>{for(let o of l.flat(1/0))d(o)!=t&&e.appendChild(u(o)?_(()=>o.val):g(o));return e},c={},v=e=>new Proxy((l,...o)=>{let[s,...a]=n(o[0]??0)===i?o:[{},...o],d=e?f.createElementNS(e,l):f.createElement(l);for(let[e,o]of r.entries(s)){let f=l=>l?r.getOwnPropertyDescriptor(l,e)??f(n(l)):t,s=l+","+e,a=c[s]??(c[s]=f(n(d))?.set??0),i=a?a.bind(d):d.setAttribute.bind(d,e);u(o)?_(()=>(i(o.val),d)):e.startsWith("on")||"function"!=typeof o?i(o):_(()=>(i(o()),d))}return w(d,...a)},{get:(e,l)=>e.bind(t,l)}),p=()=>{let l=[...e].filter(t=>t.t!==t.l);e=t;for(let e of new Set(l.flatMap(h))){let l=e.u,o=_(e.f,l);e.u=t,o!==l&&(o!=t?l.replaceWith(o):l.remove())}for(let t of l)t.l=t.t};export default{add:w,tags:v(),tagsNS:v,state:t=>({__proto__:a,t:t,l:t,i:[],o:[]}),val:d,oldVal:t=>u(t)?t.oldVal:t};