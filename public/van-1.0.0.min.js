let e,t,l,o,r=Object,f=r.getPrototypeOf,n=document,s=(e,t,l,o)=>(e??(setTimeout(l,o),new Set)).add(t),a=(e,t,o)=>{let r=l;l=t;let f=e(o);return l=r,f},i=e=>e.t=e.t.filter(e=>e.l?.isConnected),d={get val(){return l?.add(this),this.o},get oldVal(){return l?.add(this),this.i},set val(e){let l=this;if(e!==l.o){t=s(t,l,p),l.o=e;let o=new Set;for(let e of[...l.u])_(e.f),e.g=1,e.S.forEach(o.add,o);for(let e of o)e.u=e.u.filter(e=>!e.g)}}},u=f(d),w=f(a),g=e=>f(e??0)===d,S=(t,l)=>{let r=new Set,f={f:t},d=a(t,r,l);for(let t of r)o=s(o,t,()=>(o.forEach(i),o=e),1e3),t.t.push(f);return f.l=(d??n).nodeType?d:new Text(d)},_=e=>{let t=new Set,l={f:e,S:t};a(e,t);for(let e of t)e.u.push(l)},h=(t,...l)=>{for(let o of l.flat(1/0)){let l=f(o??0),r=l===d?S(()=>o.val):l===w?S(o):o;r!=e&&t.append(r)}return t},v={},c=t=>new Proxy((l,...o)=>{let[s,...a]=f(o[0]??0)===u?o:[{},...o],i=t?n.createElementNS(t,l):n.createElement(l);for(let[t,o]of r.entries(s)){let n=l=>l?r.getOwnPropertyDescriptor(l,t)??n(f(l)):e,s=l+","+t,a=v[s]??(v[s]=n(f(i))?.set??0),d=a?a.bind(i):i.setAttribute.bind(i,t);g(o)?S(()=>(d(o.val),i)):f(o??0)!==w||t.startsWith("on")&&!o._?d(o):S(()=>(d(o()),i))}return h(i,...a)},{get:(t,l)=>t.bind(e,l)}),p=()=>{let l=[...t].filter(e=>e.o!==e.i);t=e;for(let t of new Set(l.flatMap(i))){let l=t.l,o=S(t.f,l);t.l=e,o!==l&&(o!=e?l.replaceWith(o):l.remove())}for(let e of l)e.i=e.o};export default{add:h,derive:e=>(e._=1,e),tags:c(),tagsNS:c,state:e=>({__proto__:d,o:e,i:e,t:[],u:[]}),val:e=>g(e)?e.val:e,oldVal:e=>g(e)?e.oldVal:e,effect:_};